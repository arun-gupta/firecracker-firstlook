= First look at Firecracker
:toc:

= Chapter 1: What is Firecracker

**Slides**

= Chapter 2: Building Blocks of Firecracker

**Slides**

= Chapter 3: Benefits of Firecracker

**Slides**

= Chapter 4: Getting started with Firecracker 

**Prep Work**

. Create an `i3.metal` instance using Ubuntu 18.04 on EC2. 

**Code**

. Firecracker uses KVM and needs read/write access that can be granted as shown below:

    sudo setfacl -m u:${USER}:rw /dev/kvm

. Download the Firecracker binary on EC2 as:

    curl -LOJ https://github.com/firecracker-microvm/firecracker/releases/download/v0.11.0/firecracker-v0.11.0

. Start Firecracker:

    ./firecracker --api-sock /tmp/firecracker.socket

. In a new terminal, query the microVM:

    curl --unix-socket /tmp/firecracker.sock "http://localhost/machine-config"

= Chapter 5: Configure Kernel and filesystem for Firecracker

. Download a sample kernel and rootfs:

    curl -fsSL -o hello-vmlinux.bin https://s3.amazonaws.com/spec.ccfc.min/img/hello/kernel/hello-vmlinux.bin
    curl -fsSL -o hello-rootfs.ext4 https://s3.amazonaws.com/spec.ccfc.min/img/hello/fsfiles/hello-rootfs.ext4

. Setup the guest kernel:

    curl --unix-socket /tmp/firecracker.sock -i \
        -X PUT 'http://localhost/boot-source'   \
        -H 'Accept: application/json'           \
        -H 'Content-Type: application/json'     \
        -d '{        "kernel_image_path": "./hello-vmlinux.bin", "boot_args": "console=ttyS0 reboot=k panic=1 pci=off"    }'

. Setup rootfs:

    curl --unix-socket /tmp/firecracker.sock -i \
        -X PUT 'http://localhost/drives/rootfs' \
        -H 'Accept: application/json'           \
        -H 'Content-Type: application/json'     \
        -d '{        "drive_id": "rootfs",        "path_on_host": "./hello-rootfs.ext4",        "is_root_device": true,        "is_read_only": false    }'

. Start the guest machine:

    curl --unix-socket /tmp/firecracker.sock -i \
        -X PUT 'http://localhost/actions'       \
        -H  'Accept: application/json'          \
        -H  'Content-Type: application/json'    \
        -d '{        "action_type": "InstanceStart"     }'

. Terminal 1 shows a login prompt:

    Welcome to Alpine Linux 3.8
    Kernel 4.14.55-84.37.amzn2.x86_64 on an x86_64 (ttyS0)
    localhost login:

. Log in as `root` with password `root`
. Show the filesystem using `ls /`
. Terminate the microVM using `reboot`

= Chapter 6: Starting 4000 microVMs using Firecracker

**Prep Work*

. Create an `i3.metal` instance using AL2
. Update the machine:

    sudo yum update -y
    sudo yum install -y git python3

**Code**

. Install:

    git clone https://github.com/firecracker-microvm/firecracker-demo

. Setup:

    sudo tee -a /etc/security/limits.conf <<EOL
    ec2-user soft nproc 16384
    ec2-user hard nproc 16384
    EOL
    sudo setfacl -m u:${USER}:rw /dev/kvm

. In terminal 1:

    cd firecracker-demo
    TERM='xterm-256color'
    python3 microvm-tiles.py

. In terminal 2:

    cd firecracker-demo
    sudo ./0.initial-setup.sh 4000
    ./parallel-start-many.sh 0 4000 6

= Chapter 7: Integration with container runtimes

= Chapter 8: Next Steps with Firecracker


